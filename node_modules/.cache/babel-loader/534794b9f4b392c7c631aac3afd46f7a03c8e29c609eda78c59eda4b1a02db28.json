{"ast":null,"code":"import React,{useEffect,useState,useCallback}from'react';import'./App.css';import useDerivWebSocket from'./Websocket';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const apiToken='DqDY0LPWpXwcDke';const symbol='R_100';function Trade(){const{tick,error,ws}=useDerivWebSocket(apiToken,symbol);const[lastTick,setLastTick]=useState(null);const[activeContract,setActiveContract]=useState(null);const placeOrder=useCallback(async contractType=>{if(!ws)return;const options={amount:1,basis:'stake',contract_type:contractType,currency:'USD',duration:1,duration_unit:'m',symbol:symbol};try{const contract={contract_type:contractType,...options};const buyRequest={buy:1,price:0.35,parameters:contract};ws.send(JSON.stringify(buyRequest));ws.onmessage=event=>{const response=JSON.parse(event.data);console.log('WebSocket response:',response);// Add logging for the response\nif(response.error){console.error('Error in WebSocket response:',response.error);return;}if(response.msg_type==='buy'){console.log('Contract purchased:',response);if(response.buy&&response.buy.contract_id){setActiveContract(response.buy.contract_id);}else{console.error('Buy response does not contain contract_id:',response);}}else if(response.msg_type==='proposal_open_contract'){console.log('Contract update:',response);}};}catch(error){console.error('Error placing order:',error);}},[ws]);const sellContract=useCallback(async contractId=>{if(!ws||!contractId)return;const sellRequest={sell:contractId,price:0};try{ws.send(JSON.stringify(sellRequest));ws.onmessage=event=>{const response=JSON.parse(event.data);console.log('Sell WebSocket response:',response);// Add logging for the response\nif(response.error){console.error('Error in WebSocket response:',response.error);return;}if(response.msg_type==='sell'){console.log('Contract sold:',response);setActiveContract(null);}};}catch(error){console.error('Error selling contract:',error);}},[ws]);useEffect(()=>{if(tick&&lastTick){const priceChange=tick.quote-lastTick.quote;if(priceChange>0){console.log('Price increased, considering buy...');placeOrder('CALL');}else if(priceChange<0){console.log('Price decreased, considering sell...');placeOrder('PUT');}}setLastTick(tick);},[tick,lastTick,placeOrder]);useEffect(()=>{if(activeContract){const timer=setTimeout(()=>{sellContract(activeContract);},120000);// 1 minute\nreturn()=>clearTimeout(timer);}},[activeContract,sellContract]);return/*#__PURE__*/_jsx(\"div\",{className:\"Trade\",children:/*#__PURE__*/_jsxs(\"header\",{className:\"Trade-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Deriv Trading Bot\"}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:'red'},children:error}),tick&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Symbol: \",tick.symbol]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Quote: \",tick.quote]})]})]})});}export default Trade;","map":{"version":3,"names":["React","useEffect","useState","useCallback","useDerivWebSocket","jsx","_jsx","jsxs","_jsxs","apiToken","symbol","Trade","tick","error","ws","lastTick","setLastTick","activeContract","setActiveContract","placeOrder","contractType","options","amount","basis","contract_type","currency","duration","duration_unit","contract","buyRequest","buy","price","parameters","send","JSON","stringify","onmessage","event","response","parse","data","console","log","msg_type","contract_id","sellContract","contractId","sellRequest","sell","priceChange","quote","timer","setTimeout","clearTimeout","className","children","style","color"],"sources":["/home/mtume/Gava/bima/src/Trade.js"],"sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\nimport './App.css';\nimport useDerivWebSocket from './Websocket';\n\nconst apiToken = 'DqDY0LPWpXwcDke';\nconst symbol = 'R_100';\n\nfunction Trade() {\n  const { tick, error, ws } = useDerivWebSocket(apiToken, symbol);\n  const [lastTick, setLastTick] = useState(null);\n  const [activeContract, setActiveContract] = useState(null);\n\n  const placeOrder = useCallback(async (contractType) => {\n    if (!ws) return;\n\n    const options = {\n      amount: 1,\n      basis: 'stake',\n      contract_type: contractType,\n      currency: 'USD',\n      duration: 1,\n      duration_unit: 'm',\n      symbol: symbol,\n    };\n\n    try {\n      const contract = { contract_type: contractType, ...options };\n      const buyRequest = {\n        buy: 1,\n        price: 0.35,\n        parameters: contract,\n      };\n\n      ws.send(JSON.stringify(buyRequest));\n\n      ws.onmessage = (event) => {\n        const response = JSON.parse(event.data);\n        console.log('WebSocket response:', response); // Add logging for the response\n\n        if (response.error) {\n          console.error('Error in WebSocket response:', response.error);\n          return;\n        }\n\n        if (response.msg_type === 'buy') {\n          console.log('Contract purchased:', response);\n          if (response.buy && response.buy.contract_id) {\n            setActiveContract(response.buy.contract_id);\n          } else {\n            console.error('Buy response does not contain contract_id:', response);\n          }\n        } else if (response.msg_type === 'proposal_open_contract') {\n          console.log('Contract update:', response);\n        }\n      };\n    } catch (error) {\n      console.error('Error placing order:', error);\n    }\n  }, [ws]);\n\n  const sellContract = useCallback(async (contractId) => {\n    if (!ws || !contractId) return;\n\n    const sellRequest = {\n      sell: contractId,\n      price: 0,\n    };\n\n    try {\n      ws.send(JSON.stringify(sellRequest));\n\n      ws.onmessage = (event) => {\n        const response = JSON.parse(event.data);\n        console.log('Sell WebSocket response:', response); // Add logging for the response\n\n        if (response.error) {\n          console.error('Error in WebSocket response:', response.error);\n          return;\n        }\n\n        if (response.msg_type === 'sell') {\n          console.log('Contract sold:', response);\n          setActiveContract(null);\n        }\n      };\n    } catch (error) {\n      console.error('Error selling contract:', error);\n    }\n  }, [ws]);\n\n  useEffect(() => {\n    if (tick && lastTick) {\n      const priceChange = tick.quote - lastTick.quote;\n\n      if (priceChange > 0) {\n        console.log('Price increased, considering buy...');\n        placeOrder('CALL');\n      } else if (priceChange < 0) {\n        console.log('Price decreased, considering sell...');\n        placeOrder('PUT');\n      }\n    }\n    setLastTick(tick);\n  }, [tick, lastTick, placeOrder]);\n\n  useEffect(() => {\n    if (activeContract) {\n      const timer = setTimeout(() => {\n        sellContract(activeContract);\n      }, 120000); // 1 minute\n\n      return () => clearTimeout(timer);\n    }\n  }, [activeContract, sellContract]);\n\n  return (\n    <div className=\"Trade\">\n      <header className=\"Trade-header\">\n        <h1>Deriv Trading Bot</h1>\n        {error && <p style={{ color: 'red' }}>{error}</p>}\n        {tick && (\n          <div>\n            <p>Symbol: {tick.symbol}</p>\n            <p>Quote: {tick.quote}</p>\n          </div>\n        )}\n      </header>\n    </div>\n  );\n}\n\nexport default Trade;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}